# <!-- Powered by BMADâ„¢ Core -->

# Story 1.5: Update the Main Reports Page to Navigate

## Status
DONE

## Story
**As a** user,
**I want** to click the "Generate Report" button and be taken to the new summary page,
**so that** I can view my report seamlessly.

## Acceptance Criteria
1. The form on the `/reports` page is updated.
2. On form submission (clicking the button), the application programmatically navigates to `/reports/summary`, passing the selected `startDate` and `endDate` as URL query parameters.
3. The old API call for downloading a file is completely removed.

## Tasks / Subtasks
- [x] Create date range form component (AC: 1)
  - [x] Add date input fields for startDate and endDate using Shadcn/ui components
  - [x] Implement form validation to ensure both dates are provided and startDate is before endDate
  - [x] Add "Generate Report" button with proper styling and loading state
  - [x] Replace placeholder content in ReportsPage with functional form
- [x] Implement navigation logic (AC: 2)
  - [x] Import and use Next.js useRouter hook for programmatic navigation
  - [x] Create form submission handler that constructs URL with query parameters
  - [x] Navigate to `/reports/summary` with startDate and endDate as URL query parameters
  - [x] Add proper form state management and submission handling
- [x] Remove old PDF generation references (AC: 3)
  - [x] Verify no existing PDF download API calls exist in the reports page
  - [x] Ensure clean implementation without legacy PDF generation code
  - [x] Update page content to reflect new web-based report functionality
- [x] Unit testing (Testing)
  - [x] Create tests for date range form validation
  - [x] Test form submission and navigation behavior
  - [x] Test URL parameter construction with various date inputs
  - [x] Test error handling for invalid date ranges

## Dev Notes

### Previous Story Insights
From story 1.4 completion:
- Summary page route successfully created at `/reports/summary` with working query parameter handling
- Summary page can read `startDate` and `endDate` from URL query parameters using `useSearchParams()` hook
- tRPC integration working with `api.reports.getMonthlySummary.useQuery` for data fetching
- ReportView component fully functional and displays real data from database
- Date formatting standardized using DD/MM/YYYY format (Thai standard) with utilities in `src/lib/utils.ts`

From story 1.3 completion:
- ReportView component created with complete TypeScript interfaces for data structure
- Component expects specific data structure and renders correctly
- Tailwind CSS styling patterns established for report components

From story 1.2 completion:
- Summary page route structure established and working
- Query parameter handling patterns proven to work with Next.js App Router

### Architecture Context

#### Technical Stack Information
[Source: docs_mvp/architecture/3-tech-stack-updated-versions-august-2025.md]
- **Framework**: Next.js 15.4.x with App Router
- **Language**: TypeScript 5.9.x
- **UI Components**: Shadcn/ui (Latest) for form components
- **Styling**: Tailwind CSS 4.1.x for component styling
- **Icons**: Lucide Icons 0.539.x for UI iconography
- **State Management**: React Hooks pattern for form state

#### File Locations and Project Structure
[Source: docs_mvp/architecture/10-unified-project-structure.md]
- **Reports Page Location**: `src/app/(main)/reports/page.tsx` (exists and needs updating)
- **Summary Page Location**: `src/app/(main)/reports/summary/page.tsx` (exists and working)
- **UI Components**: `src/components/ui/` for Shadcn/ui components
- **Utilities**: `src/lib/utils.ts` for helper functions including date formatting

#### Navigation Patterns
[Source: docs_mvp/architecture/8-core-workflows.md]
- **Next.js App Router**: Use `useRouter` hook for programmatic navigation
- **URL Parameters**: Construct query strings for passing data between pages
- **Client Components**: Use "use client" directive for interactive form components

#### Form Component Requirements
[Source: docs_mvp/architecture/6-components.md and 11-implementation-development-standards.md]
- **UI Components**: Use Shadcn/ui design system for consistency
- **Form Components**: `Button`, `Input`, `Card`, `CardContent`, `CardHeader`, `CardTitle`
- **Validation**: Implement proper form validation for date inputs
- **Accessibility**: Follow WCAG compliance through Radix UI primitives
- **Responsive Design**: Ensure form works on both desktop and mobile

#### Current Reports Page Status
[Source: src/app/(main)/reports/page.tsx analysis]
- **Current State**: Placeholder content with "Report generation will be implemented in a future story"
- **Structure**: Basic Card layout with FileText icon and placeholder text
- **Ready for Enhancement**: Page structure in place, needs form implementation

#### Date Handling Standards
[Source: Previous story completion notes]
- **Date Format**: Use DD/MM/YYYY format (Thai standard) for consistency
- **Date Utilities**: Use `formatDisplayDate()` from `src/lib/utils.ts` for consistent formatting
- **Input Validation**: Ensure startDate is before endDate and both dates are provided

### Testing
[Source: docs_mvp/architecture/11-implementation-development-standards.md]
- **Testing Framework**: Jest + React Testing Library for component tests
- **Test Location**: Co-located with components (`src/app/(main)/reports/__tests__/page.test.tsx`)
- **Testing Commands**: 
  - `npm test` - Run Jest unit tests
  - `npm run test:watch` - Run tests in watch mode
- **Test Coverage Requirements**:
  - Form validation with various date input scenarios
  - Navigation behavior with correct URL parameter construction
  - Error handling for invalid date ranges
  - Form submission and loading states
- **Build Verification**: Run `npm run build` and `npm run lint` to ensure code quality

### Code Quality Standards
[Source: docs_mvp/architecture/11-implementation-development-standards.md]
- **TypeScript**: Strict mode enabled - all form interfaces must be properly typed
- **React Patterns**: Use React hooks for form state management
- **Component Structure**: Follow Shadcn/ui patterns for form components
- **Error Handling**: Implement proper form validation and error display
- **Navigation**: Use Next.js App Router patterns for programmatic navigation

### UI/UX Standards
[Source: Architecture analysis]
- **Design System**: All components must use Shadcn/ui design system
- **Icon Usage**: Use Lucide Icons (FileText, Calendar) for form elements
- **Layout**: Maintain consistent Card-based layout with existing page structure
- **Loading States**: Implement proper loading indicators during form submission
- **Error Display**: User-friendly error messages for validation failures

### Project Structure Notes
No conflicts identified between epic requirements and existing project structure. The reports page structure is in place and ready for form implementation. The summary page is fully functional and ready to receive navigation with query parameters.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-29 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (Dev Agent - James)

### Debug Log References
No debug issues encountered during implementation.

### Completion Notes List
- Successfully implemented date range form component with Shadcn/ui components (Input, Button, Card)
- Form includes proper validation for required fields and date range logic
- Navigation logic implemented using Next.js useRouter hook with query parameter construction
- Loading states and error handling implemented for better UX
- No existing PDF generation code found - clean implementation achieved
- Comprehensive unit tests created covering all validation scenarios and navigation behavior
- Build and lint validation passed successfully

### File List
**New Files:**
- `src/app/(main)/reports/page.test.tsx` - Unit tests for reports page form functionality

**Modified Files:**
- `src/app/(main)/reports/page.tsx` - Replaced placeholder content with functional date range form

## QA Results
[To be filled by QA agent]