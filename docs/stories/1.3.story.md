# Story 1.3: Add Company Branding to the Summary Report

## Status
DONE

## Story
**As a** shop owner,
**I want** my company logo to appear on all reports,
**so that** the documents look official and are branded.

## Acceptance Criteria
1. The company logo, as configured in the Settings page, is displayed at the top of the Summary Report.
2. The logo is rendered in grayscale.
3. The logo is scaled appropriately to fit the document header without causing layout issues.
4. If no logo URL is configured in the settings, no broken image or empty space is displayed.

## Tasks / Subtasks
- [x] Task 1: Integrate settings data into report generation (AC: 1, 4)
  - [x] Update reports router to fetch business profile data with logo URL
  - [x] Modify getMonthlySummary procedure to include logoUrl in response
  - [x] Update SummaryData interface to include logoUrl field
  - [x] Handle null/undefined logoUrl cases in data layer
- [x] Task 2: Update ReportHeader component to display company logo (AC: 1, 2, 3, 4)
  - [x] Modify ReportHeader component to accept logoUrl prop
  - [x] Add logo image element with proper positioning above shop name
  - [x] Implement grayscale CSS filter for logo display
  - [x] Add responsive scaling for logo sizing (max height/width constraints)
  - [x] Add conditional rendering to hide logo when URL is not provided
  - [x] Handle broken image loading gracefully (onError handler)
- [x] Task 3: Update type definitions and interfaces (AC: 1)
  - [x] Update ReportHeaderProps interface to include optional logoUrl
  - [x] Update SummaryData interface to include logoUrl from business profile
  - [x] Ensure TypeScript compatibility across all report components
- [x] Task 4: Unit testing for logo display functionality (AC: 1, 2, 3, 4)
  - [x] Test ReportHeader renders logo when logoUrl is provided
  - [x] Test ReportHeader applies grayscale filter to logo
  - [x] Test ReportHeader hides logo when logoUrl is null/undefined
  - [x] Test ReportHeader handles broken image URLs gracefully
  - [x] Test reports router includes logoUrl in API response
  - [x] Update ReportView.test.tsx to include logoUrl in test data

## Dev Notes

### Previous Story Insights
From Story 1.2 implementation:
- Report component structure is well-established with ReportHeader, RepairsTable, etc.
- TypeScript interfaces in `src/components/reports/types.ts` are actively maintained
- Reports router in `src/server/api/routers/reports.ts` handles data aggregation
- Test files follow naming pattern: `ComponentName.test.tsx` alongside components
- Previous stories have successfully extended the report system without breaking changes

### Data Models
**Business Profile Model** [Source: src/server/api/routers/settings.ts:5-71]: 
- `logoUrl` field is optional string with URL validation
- Accessible via `settingsRouter.getBusinessProfile` procedure
- Field can be null when not configured

**Report Data Models** [Source: src/components/reports/types.ts:3-90]:
- `SummaryData` interface currently includes shopInfo, reportPeriod, overview, salesData, repairsData, purchaseData
- `ShopInformation` interface includes name, address, phone but NOT logoUrl
- `ReportHeaderProps` interface includes shopInfo and reportPeriod but NOT logoUrl
- Needs extension to include logoUrl field

### API Specifications
**Settings Router** [Source: src/server/api/routers/settings.ts:5-18]:
- `getBusinessProfile` procedure returns complete business profile including logoUrl
- No authentication/authorization modifications needed for existing procedure

**Reports Router** [Source: Previous story implementation]:
- `getMonthlySummary` procedure in `src/server/api/routers/reports.ts` needs to fetch and include logoUrl
- Must integrate with settings router to get business profile data
- Response format needs logoUrl field added to returned data structure

### Component Specifications
**ReportHeader Component** [Source: src/components/reports/ReportHeader.tsx:1-21]:
- Currently renders shop name, address, and report title in centered layout
- Uses Tailwind classes: "text-center mb-4", "text-xl font-bold mb-1", "text-sm", "text-lg font-bold mt-3"
- Logo should be positioned above shop name in the header section
- Component receives shopInfo and reportPeriod props, needs logoUrl prop addition

**Required CSS Styling Patterns**:
- Grayscale filter: `filter: grayscale(100%)` or Tailwind `grayscale`
- Logo sizing constraints: max-height and max-width to prevent layout issues
- Center alignment consistent with existing header styling

### File Locations
Based on project structure and previous story patterns:
- **Main Component**: `src/components/reports/ReportHeader.tsx` (modification)
- **Type Definitions**: `src/components/reports/types.ts` (extension)
- **API Router**: `src/server/api/routers/reports.ts` (modification to include business profile)
- **Test Files**: `src/components/reports/ReportHeader.test.tsx` (updates)
- **Integration Test**: `src/components/reports/ReportView.test.tsx` (updates to include logoUrl)

### Technical Constraints
- **React/TypeScript**: Maintain existing component patterns [Source: CLAUDE.md - TypeScript 5.x]
- **tRPC Integration**: Use existing tRPC patterns for data fetching [Source: CLAUDE.md - tRPC 11.4.x]
- **Styling**: Continue using Tailwind CSS classes for consistency [Source: CLAUDE.md - Tailwind CSS 4.x]
- **Type Safety**: Maintain TypeScript interfaces and props validation [Source: CLAUDE.md - TypeScript strict mode]
- **No Breaking Changes**: Logo addition should not affect existing report functionality
- **Performance**: Logo loading should not block report rendering

### Testing
**Test Framework**: Jest + React Testing Library [Source: CLAUDE.md]
**Test Location**: Alongside component files as `.test.tsx` files [Source: existing test structure]
**Test Strategy**: Component tests for UI rendering, conditional logic, and API integration [Source: CLAUDE.md]
**Specific Test Cases**:
- Logo visibility when URL is provided vs. not provided
- Grayscale filter application
- Image loading error handling
- Logo scaling and positioning
- API response includes logoUrl field

### Project Structure Notes
All file paths align with established project structure:
- Components in `src/components/reports/` directory
- API routers in `src/server/api/routers/` directory  
- Type definitions co-located with components
- Test files alongside implementation files
- No structural conflicts identified

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-31 | 1.0 | Initial story creation for company branding enhancement | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-20250514

### Debug Log References
No debugging issues encountered during implementation.

### Completion Notes List
- Successfully integrated company logo functionality into Summary Reports
- Logo displays in grayscale with proper sizing constraints (max 64px height, 128px width)
- Graceful handling of missing logo URLs and broken image links
- All unit and integration tests passing
- TypeScript compilation successful
- Lint checks passing with proper ESLint disable for img element

### File List
**Modified Files:**
- `src/server/api/routers/reports.ts` - Added logoUrl to SummaryData interface and API response
- `src/components/reports/types.ts` - Extended SummaryData and ReportHeaderProps interfaces to include logoUrl
- `src/components/reports/ReportHeader.tsx` - Added logo display with grayscale filter and error handling
- `src/components/reports/ReportView.tsx` - Updated to pass logoUrl prop to ReportHeader
- `src/components/reports/ReportHeader.test.tsx` - Added comprehensive logo display tests
- `src/components/reports/ReportView.test.tsx` - Updated mock data to include logoUrl

## QA Results
*To be filled by QA agent*